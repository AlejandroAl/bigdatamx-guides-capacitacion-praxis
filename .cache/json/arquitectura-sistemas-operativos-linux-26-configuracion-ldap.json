{
    "data": {
        "markdownRemark": {
            "html": "<h2>26. Configuración Ldap :</h2>\n<h3>LDAP :</h3>\n<p>El Lightweight Directory Access Protocol o LDAP, es un protocolo que usa TCP / IP para hacer consultas y modificaciones a servicio de directorio distribuidos.</p>\n<h3>OpenLDAP :</h3>\n<p>OpenLDAP es una herramienta de código abierto para crear directorio distribuido de direcciones para autentificar  usuarios tantos equipos. </p>\n<h3>Cómo funciona LDAP :</h3>\n<p>El  servicio  de  directorio LDAP  se  basa  en  un modelo  cliente-servidor.\nUno  o más  servidores LDAP contienen los datos que conforman el árbol del directorio LDAP o base de datos troncal. el cliente LDAP se conecta con el servidor LDAP y le hace una consulta. El servidor contesta con la respuesta correspondiente, o bien con una indicación de donde puede el cliente hallar más información.</p>\n<h3>Arbol de directorio LDAP :</h3>\n<p>Un árbol de directorio no es nada más que una manera organizada de proveer contenedores para almacenar diferentes tipos de información.</p>\n<h4>Instalación de OpenLDAP :</h4>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-none\"><code>Ubuntu, Debian :\n# sudo apt-get install slapd ldap-utils\n\nCentos, Fedora, Red Hat, Oracle Linux :\n\n#yum -y install openldap compat-openldap openldap-clients openldap-servers openldap-servers-sql openldap-devel</code></pre>\n      </div>\n<h4>Instalación y Configuración :</h4>\n<p>Realizamos una instalación en una máquina virtual de Centos 7, y ahi vamos a montar nuestro servidor\nldap y vamos a realizar la configuración e instalación; la instalación se va a realizar desde el tgz de openldap.</p>\n<p>Primero nos conectamos por ssh a nuestro servidor ldap:\n<code>root@javier-orta:~# ssh -X root@192.168.86.11</code></p>\n<p>El cual nos queremos logear como usuario root, y nos va a solicitar la contraseña del usuario.\ny escribimos la contraseña, ya una vez logueados nos mostraria la consola de esta manera :</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-none\"><code>root@javier-orta:~# ssh -X root@192.168.86.11\nThe authenticity of host '192.168.86.11 (192.168.86.11)' can't be established.\nECDSA key fingerprint is SHA256:5YoVt5y1u5w9HYjh/vH3djl4ZpRsH88IMT9nX4mU1Lo.\nAre you sure you want to continue connecting (yes/no)? yes\nWarning: Permanently added '192.168.86.11' (ECDSA) to the list of known hosts.\nroot@192.168.86.11's password: \nX11 forwarding request failed on channel 0\nLast login: Wed Feb 14 11:26:45 2018\n[root@bigdata ~]# </code></pre>\n      </div>\n<p>Algo muy importante hay que ver que este configurado nuestro hostname :</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-none\"><code>[root@bigdata ~]# hostname\nbigdata.javier.ldap\n[root@bigdata ~]# </code></pre>\n      </div>\n<p>También debemos de configurar el archivo : /etc/hosts, solo le debemos de agregar el hostname,\ndebe de quedar de la siguiente manera:</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-none\"><code>  GNU nano 2.3.1                                       Fichero: /etc/hosts                                                                            Modificado  \n\n127.0.0.1   localhost bigdata.javier.ldap                                     \n::1         localhost bigdata.javier.ldap                                     </code></pre>\n      </div>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-none\"><code>[root@bigdata ~]# cat /etc/hosts\n127.0.0.1   localhost bigdata.javier.ldap\n::1         localhost bigdata.javier.ldap\n[root@bigdata ~]#</code></pre>\n      </div>\n<h4>Instalación de dependencias :</h4>\n<ul>\n<li>\n<p>Instalamos dependencias</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-none\"><code>[root@bigdata openldap-2.4.45]# yum install openssl gnutls cyrus-sasl-ldap krb5-server-ldap gcc make openssl-devel php httpd wget libtool-ltdl-devel\n[root@bigdata openldap-2.4.45]# yum install libdb -y\n[root@bigdata openldap-2.4.45]# yum install libdb-devel -y</code></pre>\n      </div>\n</li>\n</ul>\n<h4>Descargamos OpenLDAP para Linux Centos 7 :</h4>\n<p><code>wget ftp://ftp.openldap.org/pub/OpenLDAP/openldap-release/openldap-2.4.45.tgz</code></p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-none\"><code>[root@bigdata ~]# wget ftp://ftp.openldap.org/pub/OpenLDAP/openldap-release/openldap-2.4.45.tgz\n--2018-02-14 11:58:22--  ftp://ftp.openldap.org/pub/OpenLDAP/openldap-release/openldap-2.4.45.tgz\n           => “openldap-2.4.45.tgz”\nResolviendo ftp.openldap.org (ftp.openldap.org)... 23.92.27.230, 2600:3c01::f03c:91ff:fedb:ad59\nConectando con ftp.openldap.org (ftp.openldap.org)[23.92.27.230]:21... conectado.\nIdentificándose como anonymous ... ¡Dentro!\n==> SYST ... hecho.   ==> PWD ... hecho.\n==> TYPE I ... hecho.  ==> CWD (1) /pub/OpenLDAP/openldap-release ... hecho.\n==> SIZE openldap-2.4.45.tgz ... 5672845\n==> PASV ... hecho.   ==> RETR openldap-2.4.45.tgz ... hecho.\nLongitud: 5672845 (5.4M) (probablemente)\n\n100%[========================================================================================================================>] 5 672 845   1.08MB/s   en 4.5s   \n\n2018-02-14 11:58:28 (1.21 MB/s) - “openldap-2.4.45.tgz” guardado [5672845]\n\n[root@bigdata ~]# </code></pre>\n      </div>\n<p>Y vemos si existe el archivo :</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-none\"><code>[root@bigdata ~]# ls -la | grep open\n-rw-r--r--.  1 root root 5672845 feb 14 11:58 openldap-2.4.45.tgz\n[root@bigdata ~]#</code></pre>\n      </div>\n<h4>Archivo de OpenLdap :</h4>\n<p>Descomprimimos el tgz y entramos a su directorio:</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-none\"><code>[root@bigdata ~]# tar -zxf openldap-2.4.45.tgz</code></pre>\n      </div>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-none\"><code>[root@bigdata ~]# cd openldap-2.4.45</code></pre>\n      </div>\n<h4>Compilamos el código de OpenLDAP :</h4>\n<p>Comenzamos a compilar OpenLDAP :</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-none\"><code>[root@bigdata openldap-2.4.45]# ./configure\nConfiguring OpenLDAP 2.4.45-Release ...\nchecking build system type... x86_64-unknown-linux-gnu\nchecking host system type... x86_64-unknown-linux-gnu\nchecking target system type... x86_64-unknown-linux-gnu\nchecking for a BSD-compatible install... /usr/bin/install -c\nchecking whether build environment is sane... yes\nchecking for gawk... gawk\nchecking whether make sets $(MAKE)... yes\nchecking configure arguments... done\nchecking for cc... cc\nchecking for ar... ar\nchecking for style of include used by make... GNU\nchecking whether the C compiler works... yes\nchecking for C compiler default output file name... a.out\nchecking for suffix of executables... \nchecking whether we are cross compiling... no\nchecking for suffix of object files... o\nchecking whether we are using the GNU C compiler... yes\nchecking whether cc accepts -g... yes\nchecking for cc option to accept ISO C89... none needed\nchecking dependency style of cc... none\nchecking for a sed that does not truncate output... /usr/bin/sed\nchecking for grep that handles long lines and -e... /usr/bin/grep\nchecking for egrep... /usr/bin/grep -E\nchecking for ld used by cc... /usr/bin/ld\nchecking if the linker (/usr/bin/ld) is GNU ld... yes\nchecking for /usr/bin/ld option to reload object files... -r\nchecking for BSD-compatible nm... /usr/bin/nm -B\nchecking whether ln -s works... yes\nchecking how to recognise dependent libraries... pass_all\nchecking how to run the C preprocessor... cc -E\nchecking for ANSI C header files... yes\nchecking for sys/types.h... yes\n...\n\nY no nos debe de marcar ningún error.</code></pre>\n      </div>\n<p>Ejecutamos el siguiente comando :</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-none\"><code>[root@bigdata openldap-2.4.45]# make depend\nMaking depend in /root/openldap-2.4.45\n  Entering subdirectory include\nmake[1]: se ingresa al directorio `/root/openldap-2.4.45/include'\nMaking ldap_config.h\nmake[1]: se sale del directorio `/root/openldap-2.4.45/include'\n \n  Entering subdirectory libraries\nmake[1]: se ingresa al directorio `/root/openldap-2.4.45/libraries'\nMaking depend in /root/openldap-2.4.45/libraries\n  Entering subdirectory liblutil\nmake[2]: se ingresa al directorio `/root/openldap-2.4.45/libraries/liblutil'\n../../build/mkdep  -d \".\" -c \"cc\" -m \"-M\" -I../../include        -I../../include      base64.c entropy.c sasl.c signal.c hash.c passfile.c md5.c passwd.c sha1.c getpass.c lockf.c utils.c uuid.c sockpair.c avl.c tavl.c testavl.c meter.c setproctitle.c getpeereid.c detach.c \nmake[2]: se sale del directorio `/root/openldap-2.4.45/libraries/liblutil'\n \n  Entering subdirectory liblber\nmake[2]: se ingresa al directorio `/root/openldap-2.4.45/libraries/liblber'\n../../build/mkdep -l -d \".\" -c \"cc\" -m \"-M\" -I../../include -I../../include      assert.c decode.c encode.c io.c bprint.c debug.c memory.c options.c sockbuf.c stdio.c \nmake[2]: se sale del directorio `/root/openldap-2.4.45/libraries/liblber'\n \n  Entering subdirectory liblunicode\nmake[2]: se ingresa al directorio `/root/openldap-2.4.45/libraries/liblunicode'\ntouch .links\n../../build/mkdep  -d \".\" -c \"cc\" -m \"-M\" -I../../include        -I../../include      ucstr.c ucdata.c ucgendat.c ure.c urestubs.c\nmake[2]: se sale del directorio `/root/openldap-2.4.45/libraries/liblunicode'\n...\nE igual no debe de marcar ningún error.</code></pre>\n      </div>\n<p>Despues Ejecutamos :</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-none\"><code>[root@bigdata openldap-2.4.45]# make\n-c version.c\n cc -g -O2 -I../../../include -I../../../include -I.. -I./.. -I./../../../libraries/liblmdb -c version.c -o version.o\nar ruv libback_mdb.a `echo init.lo tools.lo config.lo add.lo bind.lo compare.lo delete.lo modify.lo modrdn.lo search.lo extended.lo operational.lo attr.lo index.lo key.lo filterindex.lo dn2entry.lo dn2id.lo id2entry.lo idl.lo nextid.lo monitor.lo mdb.lo midl.lo | sed 's/\\.lo/.o/g'` version.o\nar: creando libback_mdb.a\na - init.o\na - tools.o\na - config.o\na - add.o\na - bind.o\na - compare.o\na - delete.o\na - modify.o\na - modrdn.o\na - search.o\na - extended.o\na - operational.o\na - attr.o\na - index.o\na - key.o\na - filterindex.o\na - dn2entry.o\na - dn2id.o\na - id2entry.o\na - idl.o\na - nextid.o\na - monitor.o\na - mdb.o\na - midl.o\na - version.o\nmake[3]: se sale del directorio `/root/openldap-2.4.45/servers/slapd/back-mdb'\ncd back-relay; make -w all\n\nE igual no debe marcar error.</code></pre>\n      </div>\n<p>Probamos este todo bien :</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-none\"><code>[root@bigdata openldap-2.4.45]# make test\n\nY este proceso tarda mucho</code></pre>\n      </div>\n<p>Si ya todo esta bien hacemos la instalación :</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-none\"><code>[root@bigdata openldap-2.4.45]#  make install</code></pre>\n      </div>\n<p>Ahora agregamos enlaces dinamicos :\n<code>nano /etc/ld.so.conf</code></p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-none\"><code>include ld.so.conf.d/*.conf\n/usr/local/lib</code></pre>\n      </div>\n<p>Despues Ejecutamos el comando, para que guarde y refresque los cambios :\n<code>ldconfig</code></p>\n<p>Editamos la configuracion de slapd y agregamos los datos de nuestro dominio :\n<code>nano /usr/local/etc/openldap/slapd.conf</code></p>\n<p>Le agregamos o se cambian con los siguientes parametros :</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-none\"><code>database        mdb\nmaxsize         1073741824\nsuffix          \"dc=test,dc=com\"\nrootdn          \"cn=Manager,dc=test,dc=com\"</code></pre>\n      </div>\n<p>Debe de quedar :</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-none\"><code>#\n# rootdn can always read and write EVERYTHING!\n\n#######################################################################\n# MDB database definitions\n#######################################################################\n\ndatabase        mdb\nmaxsize         1073741824\nsuffix          \"dc=test,dc=com\"\nrootdn          \"cn=Manager,dc=test,dc=com\"\n\n###maxsize              1073741824\n###suffix               \"dc=my-domain,dc=com\"\n###rootdn               \"cn=Manager,dc=my-domain,dc=com\"\n# Cleartext passwords, especially for the rootdn, should\n# be avoid.  See slappasswd(8) and slapd.conf(5) for details.\n# Use of strong authentication encouraged.\nrootpw          secret\n# The database directory MUST exist prior to running slapd AND\n# should only be accessible by the slapd and slap tools.\n# Mode 700 recommended.\ndirectory\t/usr/local/var/openldap-data\n# Indices to maintain\nindex   objectClass     eq</code></pre>\n      </div>\n<p>Ejecutamos el servicio :</p>\n<p><code>/usr/local/libexec/slapd</code></p>\n<p>Y con la siguiente linea hacemos que el servicio siempre inicie al momento de encender\nla pc :</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-none\"><code>nano /etc/rc.local</code></pre>\n      </div>\n<p>y agregamos:</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-none\"><code>/usr/local/libexec/slapd</code></pre>\n      </div>\n<p>Verificamos nuestra configuracion :</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-none\"><code>[root@bigdata openldap-2.4.45]# /usr/local/bin/ldapsearch -x -b '' -s base '(objectclass=*)' namingContexts\n# extended LDIF\n#\n# LDAPv3\n# base <> with scope baseObject\n# filter: (objectclass=*)\n# requesting: namingContexts \n#\n\n#\ndn:\nnamingContexts: dc=test,dc=com\n\n# search result\nsearch: 2\nresult: 0 Success\n\n# numResponses: 2\n# numEntries: 1\n[root@bigdata openldap-2.4.45]#</code></pre>\n      </div>\n<p>Ahora creamos un ldif :</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-none\"><code>[root@bigdata openldap-2.4.45]# nano  drivemeca.ldif</code></pre>\n      </div>\n<p>Y agregamos lo siguiente :</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-none\"><code>dn: dc=test,dc=com\nobjectclass: dcObject\nobjectclass: organization\no: DriveMeca Blog \ndc: test\n\n\ndn: cn=Manager,dc=test,dc=com \nobjectclass: organizationalRole\ncn: Manager</code></pre>\n      </div>\n<p>Ahora generamos una contraseña :</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-none\"><code>[root@bigdata openldap-2.4.45]# slappasswd\nNew password: \nRe-enter new password: \n{SSHA}LlrMuXw/YghrwzRh8BFRP1uwi2+R0aqN\n[root@bigdata openldap-2.4.45]#</code></pre>\n      </div>\n<p>Agregamos la contraseña a la Configuración :</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-none\"><code>nano /usr/local/etc/openldap/slapd.conf\n\ny agregamos :\n\nrootpw {SSHA}LlrMuXw/YghrwzRh8BFRP1uwi2+R0aqN</code></pre>\n      </div>\n<p>Sólo se cambia lo que se tiene en rootpw :</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-none\"><code># Cleartext passwords, especially for the rootdn, should\n# be avoid.  See slappasswd(8) and slapd.conf(5) for details.\n# Use of strong authentication encouraged.\nrootpw          {SSHA}LlrMuXw/YghrwzRh8BFRP1uwi2+R0aqN\n# The database directory MUST exist prior to running slapd AND\n# should only be accessible by the slapd and slap tools.\n# Mode 700 recommended.\ndirectory\t/usr/local/var/openldap-data\n# Indices to maintain\nindex   objectClass     eq</code></pre>\n      </div>\n<p>Despues buscamos y matamos el proceso :\n<code>ps -ax|grep slapd</code></p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-none\"><code>[root@bigdata openldap-2.4.45]# ps -ax|grep slapd\n109541 ?        Ssl    0:00 /usr/local/libexec/slapd\n109558 pts/0    S+     0:00 grep --color=auto slapd\n[root@bigdata openldap-2.4.45]# kill 109541\n[root@bigdata openldap-2.4.45]#</code></pre>\n      </div>\n<p>Ahora lo volvemos ejecutar, para que lo inicie con los nuevos cambios :\n<code>/usr/local/libexec/slapd</code></p>\n<h5>Verificamos configuracion de OpenLDAP :</h5>\n<p>Probamos a agregar una entrada usando el archivo ldif que creamos antes y escribimos la contraseña que ya hemos generado :\n<code>/usr/local/bin/ldapadd -x -D \"cn=Manager,dc=test,dc=com\" -W -f drivemeca.ldif</code></p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-none\"><code>[root@bigdata openldap-2.4.45]# /usr/local/bin/ldapadd -x -D \"cn=Manager,dc=test,dc=com\" -W -f drivemeca.ldif\nEnter LDAP Password: \nadding new entry \"dc=test,dc=com\"\n\nadding new entry \"cn=Manager,dc=test,dc=com \"\nldap_add: Object class violation (65)\n\tadditional info: invalid structural object class chain (organizationalRole/organization)\n\n[root@bigdata openldap-2.4.45]#</code></pre>\n      </div>\n<p>Por último :</p>\n<p>Abrimos el puerto en el firewall y dejamos el cambio permanente :</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-none\"><code>[root@bigdata openldap-2.4.45]# firewall-cmd --add-service=ldap --permanent\nsuccess\n[root@bigdata openldap-2.4.45]# firewall-cmd --reload\nsuccess\n[root@bigdata openldap-2.4.45]#</code></pre>\n      </div>\n<h4>Para más información:</h4>\n<!-- Please add any articles you think might be helpful to read before writing the article -->\n<ul>\n<li>\n<p>Instalar y configurar OpenLDAP en el servidor Ubuntu :   <a href='http://somebooks.es/12-7-instalar-y-configurar-openldap-en-el-servidor-ubuntu/' target='_blank' rel='nofollow'>http://somebooks.es/12-7-instalar-y-configurar-openldap-en-el-servidor-ubuntu/</a></p>\n</li>\n<li>\n<p>Como instalar y configurar OpenLDAP en Linux Centos 7 :\n<a href='http://drivemeca.blogspot.mx/2016/06/como-instalar-y-configurar-openldap-en.html' target='_blank' rel='nofollow'>http://drivemeca.blogspot.mx/2016/06/como-instalar-y-configurar-openldap-en.html</a> </p>\n</li>\n</ul>\n<ul>\n<li>\n<p>Descripción general de la configuración de OpenLDAP :\n<a href='http://web.mit.edu/rhel-doc/4/RH-DOCS/rhel-rg-es-4/s1-ldap-quickstart.html' target='_blank' rel='nofollow'>http://web.mit.edu/rhel-doc/4/RH-DOCS/rhel-rg-es-4/s1-ldap-quickstart.html</a> </p>\n</li>\n<li>\n<p>Cómo configurar LDAP en Ubuntu Server o Debian :\n<a href='https://www.dragonjar.org/como-configurar-ldap-en-ubuntu-server-o-debian.xhtml' target='_blank' rel='nofollow'>https://www.dragonjar.org/como-configurar-ldap-en-ubuntu-server-o-debian.xhtml</a> </p>\n</li>\n</ul>",
            "fields": {
                "slug": "/arquitectura-sistemas-operativos-linux/26-configuracion-ldap/"
            },
            "frontmatter": {
                "title": ""
            }
        }
    },
    "pathContext": {
        "slug": "/arquitectura-sistemas-operativos-linux/26-configuracion-ldap/"
    }
}